<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chicken Disease Classifier</title>
    <link rel="shortcut icon" href="data:image/png;base64,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" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px 0;
        }

        .container-main {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2rem;
            }
        }

        .card-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
            transition: transform 0.3s ease;
        }

        .card-section:hover {
            transform: translateY(-5px);
        }

        .card-title {
            color: #667eea;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            font-size: 1.8rem;
        }

        .upload-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .image-preview {
            width: 100%;
            height: 300px;
            border: 3px dashed #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9ff;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .image-preview:hover {
            border-color: #764ba2;
            background: #f0f2ff;
        }

        .image-preview.drag-over {
            border-color: #764ba2;
            background: #e8ecff;
            transform: scale(1.02);
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-placeholder {
            text-align: center;
            color: #999;
            pointer-events: none;
        }

        .upload-placeholder i {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 10px;
            display: block;
        }

        .upload-placeholder p {
            margin: 0;
            font-size: 1rem;
        }

        .upload-text {
            font-size: 0.9rem;
            color: #999;
        }

        .button-group {
            display: flex;
            gap: 15px;
            width: 100%;
        }

        .btn-custom {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-upload {
            background: #667eea;
            color: white;
        }

        .btn-upload:hover {
            background: #5568d3;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }

        .btn-predict {
            background: #48bb78;
            color: white;
        }

        .btn-predict:hover {
            background: #38a169;
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
            transform: translateY(-2px);
        }

        .btn-predict:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-clear {
            background: #f56565;
            color: white;
            padding: 10px 15px;
        }

        .btn-clear:hover {
            background: #e53e3e;
        }

        #fileinput {
            display: none;
        }

        .results-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .result-item {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .result-title {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .prediction-result {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .class-prediction {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .class-prediction:last-child {
            border-bottom: none;
        }

        .class-name {
            font-weight: 600;
            color: #333;
            text-transform: capitalize;
            min-width: 100px;
        }

        .confidence-bar {
            flex: 1;
            margin: 0 15px;
            height: 25px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            transition: width 0.5s ease;
        }

        .result-image {
            text-align: center;
        }

        .result-image img {
            max-width: 100%;
            max-height: 250px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .json-result {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.5;
        }

        #loading {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            margin-top: 20px;
            font-size: 1.1rem;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
            display: block;
        }

        .alert-custom {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #f0fdf4;
            border-color: #48bb78;
            color: #22543d;
        }

        .alert-error {
            background: #fef2f2;
            border-color: #f56565;
            color: #742a2a;
        }

        .alert-warning {
            background: #fffaf0;
            border-color: #ed8936;
            color: #7c2d12;
        }

        .canvas-hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container-main">
        <div class="header">
            <h1><i class="fas fa-virus"></i> Chicken Disease Classifier</h1>
            <p>AI-Powered Disease Detection System</p>
        </div>

        <div class="main-content">
            <!-- Upload Section -->
            <div class="card-section">
                <div class="card-title">
                    <i class="fas fa-image"></i>
                    Upload Image
                </div>
                
                <div class="upload-area">
                    <div class="image-preview" id="preview">
                        <div class="upload-placeholder">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Drag & Drop your image here</p>
                            <span class="upload-text">or click to select</span>
                        </div>
                    </div>

                    <canvas id="canvas" class="canvas-hidden"></canvas>
                    <img src="" id="photo" style="display: none;" />

                    <input type="file" id="fileinput" accept="image/*" />

                    <div class="button-group">
                        <button type="button" class="btn-custom btn-upload" id="uploadBtn">
                            <i class="fas fa-folder-open"></i> Choose Image
                        </button>
                        <button type="button" class="btn-custom btn-predict" id="predictBtn" disabled>
                            <i class="fas fa-magic"></i> Predict
                        </button>
                    </div>

                    <button type="button" class="btn-custom btn-clear" id="clearBtn" style="display: none;">
                        <i class="fas fa-redo"></i> Clear
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="card-section">
                <div class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    Prediction Results
                </div>

                <div class="results-section">
                    <div id="results-container">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Upload an image and click "Predict" to see results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden API URL -->
    <input type="hidden" id="apiUrl" value="/predict" />

    <!-- Loading Overlay -->
    <div id="loading">
        <div>
            <div class="spinner"></div>
            <div class="loading-text">Analyzing image...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>
        let base64Data = "";
        const preview = document.getElementById('preview');
        const fileinput = document.getElementById('fileinput');
        const uploadBtn = document.getElementById('uploadBtn');
        const predictBtn = document.getElementById('predictBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultsContainer = document.getElementById('results-container');
        const loading = document.getElementById('loading');
        const canvas = document.getElementById('canvas');
        const photo = document.getElementById('photo');

        // Upload button click
        uploadBtn.addEventListener('click', () => {
            fileinput.click();
        });

        // File input change
        fileinput.addEventListener('change', handleFileSelect);

        // Drag and drop
        preview.addEventListener('dragover', (e) => {
            e.preventDefault();
            preview.classList.add('drag-over');
        });

        preview.addEventListener('dragleave', () => {
            preview.classList.remove('drag-over');
        });

        preview.addEventListener('drop', (e) => {
            e.preventDefault();
            preview.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileinput.files = files;
                handleFileSelect();
            }
        });

        preview.addEventListener('click', () => {
            fileinput.click();
        });

        // Handle file selection
        function handleFileSelect() {
            const file = fileinput.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showAlert('Please select a valid image file', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const url = e.target.result;
                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.onload = () => {
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    base64Data = canvas.toDataURL('image/jpeg', 1.0).replace(/^data:image.+;base64,/, '');
                };
                img.onerror = () => {
                    showAlert('Failed to load image', 'error');
                };
                img.src = url;

                // Update preview
                updatePreview(url);
                predictBtn.disabled = false;
                clearBtn.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        // Update preview display
        function updatePreview(src) {
            preview.innerHTML = `<img src="${src}" alt="Preview" />`;
        }

        // Clear button
        clearBtn.addEventListener('click', () => {
            base64Data = "";
            fileinput.value = "";
            preview.innerHTML = `
                <div class="upload-placeholder">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag & Drop your image here</p>
                    <span class="upload-text">or click to select</span>
                </div>
            `;
            resultsContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>Upload an image and click "Predict" to see results</p>
                </div>
            `;
            predictBtn.disabled = true;
            clearBtn.style.display = 'none';
        });

        // Predict button
        predictBtn.addEventListener('click', () => {
            if (!base64Data) {
                showAlert('Please select an image first', 'warning');
                return;
            }
            sendPredictionRequest(base64Data);
        });

        // Send prediction request
        function sendPredictionRequest(imageData) {
            const url = document.getElementById('apiUrl').value;
            loading.style.display = 'flex';

            $.ajax({
                url: url,
                type: 'POST',
                cache: false,
                async: true,
                crossDomain: true,
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'
                },
                data: JSON.stringify({ image: imageData }),
                success: (response) => {
                    loading.style.display = 'none';
                    displayResults(response);
                },
                error: (error) => {
                    loading.style.display = 'none';
                    console.error('Prediction error:', error);
                    showAlert('Failed to get prediction. Please try again.', 'error');
                }
            });
        }

        // Display results
        function displayResults(response) {
            resultsContainer.innerHTML = "";

            // Check if response is array
            let predictions = Array.isArray(response) ? response[0] : response;
            let imageData = Array.isArray(response) && response[1] ? response[1].image : null;

            if (!predictions) {
                showAlert('Invalid response format', 'error');
                return;
            }

            // Display image if available
            if (imageData && imageData.length > 100) {
                const imagHTML = `
                    <div class="result-item">
                        <div class="result-title">Processed Image</div>
                        <div class="result-image">
                            <img src="data:image/jpeg;base64,${imageData}" alt="Prediction Result" />
                        </div>
                    </div>
                `;
                resultsContainer.innerHTML += imagHTML;
            }

            // Get the top prediction (usually 'image' or class name)
            const classKey = Object.keys(predictions).find(key => key !== 'image');
            
            if (classKey && predictions[classKey]) {
                const classResults = predictions[classKey];
                
                // Find the class with highest confidence
                let maxConfidence = 0;
                let maxClass = '';
                const classEntries = [];

                for (const [className, confidence] of Object.entries(classResults)) {
                    const conf = parseFloat(confidence);
                    classEntries.push({ name: className, confidence: conf });
                    if (conf > maxConfidence) {
                        maxConfidence = conf;
                        maxClass = className;
                    }
                }

                // Create prediction result HTML
                let resultHTML = `
                    <div class="result-item">
                        <div class="result-title">
                            <i class="fas fa-check-circle" style="color: #48bb78;"></i>
                            Prediction: <strong>${maxClass}</strong>
                        </div>
                        <div class="prediction-result">
                `;

                // Sort by confidence descending
                classEntries.sort((a, b) => b.confidence - a.confidence);

                classEntries.forEach(entry => {
                    const confPercent = (entry.confidence * 100).toFixed(2);
                    const barWidth = entry.confidence * 100;
                    resultHTML += `
                        <div class="class-prediction">
                            <span class="class-name">${entry.name}</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${barWidth}%">
                                    ${confPercent}%
                                </div>
                            </div>
                        </div>
                    `;
                });

                resultHTML += `
                        </div>
                    </div>
                `;

                resultsContainer.innerHTML += resultHTML;

                // Show success message
                showAlert(`Successfully detected: ${maxClass} (${(maxConfidence * 100).toFixed(2)}% confidence)`, 'success');
            } else {
                // Display raw JSON if structure is different
                const jsonHTML = `
                    <div class="result-item">
                        <div class="result-title">Raw Response</div>
                        <div class="json-result">
                            ${escapeHtml(JSON.stringify(predictions, null, 2))}
                        </div>
                    </div>
                `;
                resultsContainer.innerHTML += jsonHTML;
            }
        }

        // Show alert messages
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert-custom alert-${type}`;
            const iconMap = {
                'error': 'exclamation-circle',
                'success': 'check-circle',
                'warning': 'info-circle',
                'info': 'info-circle'
            };
            alertDiv.innerHTML = `<i class="fas fa-${iconMap[type]}"></i> <span>${message}</span>`;
            
            resultsContainer.insertBefore(alertDiv, resultsContainer.firstChild);
            
            // Auto-remove after 5 seconds
            setTimeout(() => alertDiv.remove(), 5000);
        }

        // Escape HTML special characters
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Initialize
        loading.style.display = 'none';
    </script>
</body>
</html>
